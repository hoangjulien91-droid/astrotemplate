---
/**
 * S-TIER — Navbar Component
 * Transparent floating navbar with glassmorphism on scroll
 */
import { getEntry } from "astro:content";

interface Props {
  transparent?: boolean;
}

const { transparent = true } = Astro.props;
const company = await getEntry("config", "company");

const navLinks = [
  { href: "/", label: "Accueil" },
  { href: "/portfolio", label: "Portfolio" },
  { href: "/a-propos", label: "À Propos" },
  { href: "/contact", label: "Contact" },
];

const currentPath = Astro.url.pathname;
---

<header class:list={["navbar", { "navbar--transparent": transparent }]}>
  <div class="navbar__container container">
    <!-- Logo -->
    <a href="/" class="navbar__logo" transition:name="logo">
      <span class="navbar__logo-text">{company?.data.name || "RC"}</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="navbar__nav" aria-label="Navigation principale">
      <ul class="navbar__links">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class:list={[
                  "navbar__link",
                  { "navbar__link--active": currentPath === link.href },
                ]}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- Mobile Menu Button (Progressive Enhancement) -->
    <button
      class="navbar__mobile-toggle"
      aria-label="Ouvrir le menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="navbar__hamburger"></span>
    </button>
  </div>
</header>

<!-- Mobile Menu (Initially hidden, enhanced with JS island) -->
<div id="mobile-menu" class="mobile-menu" aria-hidden="true">
  <nav class="mobile-menu__nav">
    <ul class="mobile-menu__links">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                "mobile-menu__link",
                { "mobile-menu__link--active": currentPath === link.href },
              ]}
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</div>

<style>
  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    padding: 1rem 0;
    transition: all 0.3s ease;
  }

  .navbar--transparent {
    background: transparent;
  }

  .navbar:not(.navbar--transparent),
  .navbar.scrolled {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-bottom: 1px solid var(--glass-border);
  }

  .navbar__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* Logo */
  .navbar__logo {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-decoration: none;
    letter-spacing: -0.02em;
  }

  .navbar__logo:hover {
    color: var(--color-accent);
  }

  /* Desktop Nav */
  .navbar__nav {
    display: none;
  }

  @media (min-width: 768px) {
    .navbar__nav {
      display: block;
    }
  }

  .navbar__links {
    display: flex;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .navbar__link {
    font-family: var(--font-display);
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    text-decoration: none;
    position: relative;
    padding: 0.5rem 0;
    transition: color 0.2s ease;
  }

  .navbar__link::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--color-accent);
    transition: width 0.3s ease;
  }

  .navbar__link:hover,
  .navbar__link--active {
    color: var(--color-text-primary);
  }

  .navbar__link:hover::after,
  .navbar__link--active::after {
    width: 100%;
  }

  /* Mobile Toggle */
  .navbar__mobile-toggle {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 44px;
    height: 44px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  @media (min-width: 768px) {
    .navbar__mobile-toggle {
      display: none;
    }
  }

  .navbar__hamburger {
    width: 24px;
    height: 2px;
    background: var(--color-text-primary);
    position: relative;
    transition: background 0.2s ease;
  }

  .navbar__hamburger::before,
  .navbar__hamburger::after {
    content: "";
    position: absolute;
    width: 24px;
    height: 2px;
    background: var(--color-text-primary);
    left: 0;
    transition: transform 0.3s ease;
  }

  .navbar__hamburger::before {
    top: -8px;
  }

  .navbar__hamburger::after {
    top: 8px;
  }

  /* Mobile Menu */
  .mobile-menu {
    position: fixed;
    inset: 0;
    z-index: 99;
    background: var(--color-bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .mobile-menu[aria-hidden="false"] {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu__links {
    list-style: none;
    padding: 0;
    margin: 0;
    text-align: center;
  }

  .mobile-menu__link {
    display: block;
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 600;
    color: var(--color-text-primary);
    padding: 1rem;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .mobile-menu__link:hover,
  .mobile-menu__link--active {
    color: var(--color-accent);
  }
</style>

<script>
  // Re-run on every page navigation (View Transitions compatible)
  document.addEventListener("astro:page-load", () => {
    const navbar = document.querySelector(".navbar");
    const mobileToggle = document.querySelector(".navbar__mobile-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    // Scroll effect
    const handleScroll = () => {
      if (window.scrollY > 50) {
        navbar?.classList.add("scrolled");
      } else {
        navbar?.classList.remove("scrolled");
      }
    };

    window.addEventListener("scroll", handleScroll);
    handleScroll(); // Run once on load

    // Mobile menu toggle
    mobileToggle?.addEventListener("click", () => {
      const isOpen = mobileMenu?.getAttribute("aria-hidden") === "false";
      mobileMenu?.setAttribute("aria-hidden", isOpen ? "true" : "false");
      mobileToggle.setAttribute("aria-expanded", isOpen ? "false" : "true");
      document.body.style.overflow = isOpen ? "" : "hidden";
    });

    // Close mobile menu on link click
    mobileMenu?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.setAttribute("aria-hidden", "true");
        mobileToggle?.setAttribute("aria-expanded", "false");
        document.body.style.overflow = "";
      });
    });
  });
</script>
